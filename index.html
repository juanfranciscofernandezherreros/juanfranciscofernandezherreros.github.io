<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fundamentos Kafka ‚Äî Documentaci√≥n</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{--sidebar-width:300px}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;}
    .sidebar{position:fixed;top:0;left:0;height:100vh;width:var(--sidebar-width);padding:2rem 1rem;background:#0f172a;color:#fff;overflow:auto}
    .sidebar a{color:#c7d2fe;text-decoration:none;display:block;padding:.35rem 0}
    .sidebar a.active{color:#fff;font-weight:600}
    .content{margin-left:calc(var(--sidebar-width) + 2rem);padding:2rem;max-width:980px}
    .section-card{background:#fff;border-radius:.5rem;padding:1.25rem;margin-bottom:1.25rem;box-shadow:0 6px 18px rgba(15,23,42,0.06)}
    pre code{white-space:pre-wrap}
    table th, table td{vertical-align:middle}
    .toc-title{font-size:.9rem;color:#94a3b8;margin-bottom:.6rem}
    .copy-btn{font-size:.8rem}
    @media (max-width:992px){
      .sidebar{position:static;width:100%;height:auto;padding:1rem 0}
      .content{margin-left:0;padding:1rem}
    }
  </style>
</head>
<body>

  <div class="sidebar">
    <h4 class="mb-3">üìò Kafka ‚Äî √çndice</h4>
    <div class="toc-title">Navegaci√≥n r√°pida</div>
    <nav id="toc">
      <a href="#fundamentals">I. Fundamentals of Message and Cluster</a>
      <a href="#cluster-components">‚Ä¢ Cluster Components</a>
      <a href="#flow-components">‚Ä¢ Flow Components</a>
      <a href="#message-components">‚Ä¢ Message Components</a>

      <a href="#structure">II. Structure, Compatibility, and Access</a>
      <a href="#data-structure">‚Ä¢ Data Structure (Avro & Schema Registry)</a>
      <a href="#integration">‚Ä¢ Integration & REST Proxy</a>

      <a href="#continuous">III. Continuous Processing</a>
      <a href="#kstream">‚Ä¢ Data Abstractions (KStream / KTable)</a>
      <a href="#ksqldb">‚Ä¢ ksqlDB</a>
      <a href="#state-ops">‚Ä¢ State Ops: Changelog & Repartitioning</a>

      <a href="#performance">IV. Performance Optimization</a>
      <a href="#producer-opt">‚Ä¢ Producer (Batch Writing)</a>
      <a href="#consumer-opt">‚Ä¢ Consumer (Batch Reading)</a>

      <a href="#changelog">Changelog Topics</a>
      <a href="#repartition">Repartition Topics</a>

      <a href="#conclusion" class="mt-3">Conclusi√≥n</a>
    </nav>

    <div class="mt-4">
      <button id="githubPublish" class="btn btn-sm btn-outline-light">Preparar para GitHub Pages</button>
      <div class="small mt-2 text-muted">Archivo listo para publicar en &lt;user&gt;.github.io/</div>
    </div>
  </div>

  <main class="content">
    <header class="mb-4">
      <h1>Fundamentos de Kafka ‚Äî Gu√≠a Compacta</h1>
      <p class="text-muted">Versi√≥n SPA lista para publicar en <code>GitHub Pages</code>. Usa el √≠ndice lateral para navegar por las secciones.</p>
    </header>

    <section id="fundamentals" class="section-card">
      <h2>I. Fundamentals of Message and Cluster <small class="text-muted">(Basic Level)</small></h2>
      <p>Focuses on the core infrastructure and data unit.</p>

      <h3 id="cluster-components">A. Cluster Components</h3>
      <div class="table-responsive">
        <table class="table table-sm table-bordered">
          <thead class="table-light"><tr><th>Component</th><th>Definition</th></tr></thead>
          <tbody>
            <tr><td><strong>Broker</strong></td><td>The server that hosts and stores Kafka messages. Several are needed for fault tolerance.</td></tr>
            <tr><td><strong>Topic</strong></td><td>The logical store for messages. Producers write to it, and consumers read from it.</td></tr>
            <tr><td><strong>Partition</strong></td><td>The physical unit within the Topic that allows for scalability and parallelism. Each partition is an ordered message log.</td></tr>
            <tr><td><strong>Offset</strong></td><td>The unique sequential identifier for each message within a Partition. Used by consumers to track their reading position.</td></tr>
          </tbody>
        </table>
      </div>

      <h3 id="flow-components">B. Flow Components</h3>
      <table class="table table-sm table-bordered">
        <thead class="table-light"><tr><th>Component</th><th>Definition</th></tr></thead>
        <tbody>
          <tr><td><strong>Producer</strong></td><td>The application that sends messages to a Topic.</td></tr>
          <tr><td><strong>Consumer</strong></td><td>The application that reads messages from one or more Partitions.</td></tr>
        </tbody>
      </table>

      <h3 id="message-components">C. Message Components</h3>
      <table class="table table-sm table-bordered">
        <thead class="table-light"><tr><th>Component</th><th>Definition</th></tr></thead>
        <tbody>
          <tr><td><strong>Value</strong></td><td>The actual data being transmitted (e.g., a JSON or Avro object).</td></tr>
          <tr><td><strong>Key</strong></td><td>A field (e.g., userId or productId) used to guarantee grouping and ordering of related messages on the same Partition.</td></tr>
          <tr><td><strong>Headers</strong></td><td>Metadata attached to the message for tracking or routing purposes.</td></tr>
        </tbody>
      </table>
    </section>

    <section id="structure" class="section-card">
      <h2>II. Structure, Compatibility, and Access <small class="text-muted">(Intermediate Level)</small></h2>
      <p>Focuses on ensuring data quality and flexibility in integration.</p>

      <h3 id="data-structure">A. Data Structure (Quality Assurance)</h3>
      <table class="table table-sm table-bordered">
        <thead class="table-light"><tr><th>Component</th><th>Definition</th></tr></thead>
        <tbody>
          <tr><td><strong>Avro</strong></td><td>Schema-based serialization format. It allows for backward and forward compatible data evolution.</td></tr>
          <tr><td><strong>Schema Registry</strong></td><td>A centralized store for all data schemas. It's vital for compatibility between Producers and Consumers.</td></tr>
        </tbody>
      </table>

      <h3 id="integration">B. Integration and Flexible Access (APIs)</h3>
      <table class="table table-sm table-bordered">
        <thead class="table-light"><tr><th>Component</th><th>Definition</th></tr></thead>
        <tbody>
          <tr><td><strong>Kafka REST Proxy</strong></td><td>An HTTP gateway that allows any application (Non-Producer/Non-Consumer) to interact with the cluster using standard web requests (instead of native Kafka libraries).</td></tr>
          <tr><td><strong>REST Data Flow</strong></td><td>Interaction: Non-Producer ‚Üí REST Proxy ‚Üí Schema Registry (for serialization/deserialization) ‚Üí Kafka Cluster.</td></tr>
        </tbody>
      </table>
    </section>

    <section id="continuous" class="section-card">
      <h2>III. Continuous Processing (Kafka Streams &amp; ksqlDB)</h2>
      <p>Focuses on real-time data processing and state management.</p>

      <h3 id="kstream">A. Data Abstractions (Kafka Streams API)</h3>
      <div class="table-responsive">
        <table class="table table-sm table-bordered">
          <thead class="table-light"><tr><th>Abstraction</th><th>Representation</th><th>Nature</th></tr></thead>
          <tbody>
            <tr><td><strong>KStream</strong></td><td>Stream of Events (e.g., clicks, transactions).</td><td>Immutable. Each record is a fact that has occurred.</td></tr>
            <tr><td><strong>KTable</strong></td><td>State Table (e.g., current stock, user profile).</td><td>Mutable. The latest record for a given key overwrites the previous one.</td></tr>
          </tbody>
        </table>
      </div>

      <h3 id="ksqldb">B. Processing Engine (ksqlDB)</h3>
      <p><strong>ksqlDB</strong> ‚Äî A streaming database that executes Kafka Streams logic using continuous SQL commands. It allows creating KStreams (<code>CREATE STREAM</code>) and KTables (<code>CREATE TABLE</code>) without writing programmatic Kafka Streams code.</p>

      <h3 id="state-ops">C. State Operations and Durability</h3>
      <table class="table table-sm table-bordered">
        <thead class="table-light"><tr><th>Component</th><th>Definition</th></tr></thead>
        <tbody>
          <tr><td><strong>Changelog Topic</strong></td><td>Internal compacted Topic that acts as the durable backup of a KTable's local state (State Store). Used for fault recovery.</td></tr>
          <tr><td><strong>Repartitioning</strong></td><td>Internal "shuffle" process that consumes data from one topic and produces it to a temporary topic to ensure the new Key is correctly aligned. Essential before complex stateful operations (join, groupBy).</td></tr>
        </tbody>
      </table>
    </section>

    <section id="performance" class="section-card">
      <h2>IV. Performance Optimization <small class="text-muted">(Advanced Level)</small></h2>
      <p>Detailed analysis of configurations for High Throughput and Batch Processing.</p>

      <h3 id="producer-opt">A. Producer Optimization (Batch Writing)</h3>
      <div class="table-responsive">
        <table class="table table-sm table-bordered">
          <thead class="table-light"><tr><th>Property</th><th>Purpose</th><th>Primary Effect</th></tr></thead>
          <tbody>
            <tr><td><strong>batch.size &amp; linger.ms</strong></td><td>Batching. Define the maximum batch size (in bytes) and maximum waiting time (in ms) before sending messages to the Broker.</td><td>Reduces network calls (higher efficiency, lower latency).</td></tr>
            <tr><td><strong>buffer.memory &amp; max.block.ms</strong></td><td>Memory Management. Controls the available memory buffer for messages and the time the Producer can block if the buffer is full.</td><td>Controls the sending flow under high pressure.</td></tr>
            <tr><td><strong>request.timeout.ms</strong></td><td>Request Timeout. Maximum time to wait for a response from the Broker for a send request.</td><td>Defines the maximum wait for a broker acknowledgment.</td></tr>
            <tr><td><strong>delivery.timeout.ms</strong></td><td>Total Delivery Timeout. Total time allowed for message delivery, including buffering and retries.</td><td>Sets the maximum lifespan of a message within the producer.</td></tr>
            <tr><td><strong>max.block.ms</strong></td><td>Blocking Time. Time the send() method will block if the producer's buffers are full.</td><td>Prevents indefinite blocking of the sending application.</td></tr>
          </tbody>
        </table>
      </div>

      <h3 id="consumer-opt">B. Consumer Optimization (Batch Reading)</h3>
      <div class="table-responsive">
        <table class="table table-sm table-bordered">
          <thead class="table-light"><tr><th>Property</th><th>Purpose</th><th>Primary Effect</th></tr></thead>
          <tbody>
            <tr><td><strong>listener.type: batch &amp; max.poll.records</strong></td><td>Processing Batches. Configures the listener to receive a full batch of messages and the maximum size of this batch.</td><td>Increases throughput by processing more messages at once.</td></tr>
            <tr><td><strong>fetch.min.bytes &amp; fetch.max.wait.ms</strong></td><td>Network Efficiency. Forces the Broker to wait (up to a time limit) until it has a minimum amount of bytes to send to the Consumer.</td><td>Reduces inefficient polling and guarantees large batches.</td></tr>
            <tr><td><strong>max.poll.interval.ms</strong></td><td>Processing Tolerance. The maximum time the Consumer has to process the batch of messages.</td><td>Critical for preventing unnecessary rebalances in applications with heavy processing.</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="changelog" class="section-card">
      <h2>Changelog Topics</h2>
      <p>Changelog topics (or change log topics) are internal topics that Kafka Streams creates to maintain a durable copy of the state for stateful operations (like <code>aggregate</code>, <code>count</code>, <code>reduce</code>, <code>join</code>, etc.).</p>
      <p>Kafka Streams maintains state in local state stores (e.g., RocksDB).</p>
      <ul>
        <li>Saves every update to the local state.</li>
        <li>Allows the application instance to recover the state if it fails or if a partition is reassigned to another instance.</li>
        <li>Ensures fault tolerance and consistent reprocessing.</li>
      </ul>
    </section>

    <section id="repartition" class="section-card">
      <h2>Repartition Topics</h2>
      <p>Repartition topics are created when Kafka Streams needs to reorganize (repartition) the data to ensure that all events with the same key land in the same partition before stateful operations like <code>groupByKey()</code> or <code>join()</code>.</p>
      <p><strong>What They Are Used For:</strong></p>
      <ul>
        <li>In Kafka, operations that depend on the key (like aggregations or joins) require that the data be partitioned by that key.</li>
        <li>If you change the key using a <code>groupBy()</code> or <code>selectKey()</code>, Kafka Streams must ensure the data is distributed correctly. Therefore, it creates an intermediate repartition topic.</li>
      </ul>
    </section>

    <section id="conclusion" class="section-card">
      <h2>Conclusi√≥n</h2>
      <p>Esta SPA contiene el art√≠culo t√©cnico sobre Kafka estructurado como documentaci√≥n para publicar en GitHub Pages. Puedes descargar este archivo como <code>index.html</code> y subirlo a tu repositorio <code>&lt;usuario&gt;.github.io</code> o a la rama <code>gh-pages</code> para que sea servido autom√°ticamente.</p>
      <p>Si quieres, puedo:</p>
      <ul>
        <li>Generar autom√°ticamente el repo y los comandos git para publicar (README con instrucciones).</li>
        <li>A√±adir estilo adicional (modo oscuro, resaltar c√≥digo con PrismJS, b√∫squeda interna).</li>
        <li>Incluir enlaces a ejemplos de comandos Kafka/ksqlDB.</li>
      </ul>
    </section>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Active TOC link on scroll
    const tocLinks = document.querySelectorAll('#toc a');
    const sections = Array.from(tocLinks).map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);

    function onScroll(){
      const y = window.scrollY + 120;
      let idx = sections.length - 1;
      for(let i=0;i<sections.length;i++){
        if(sections[i].offsetTop > y){ idx = i-1; break; }
      }
      tocLinks.forEach(l=>l.classList.remove('active'));
      if(idx >=0) tocLinks[idx].classList.add('active');
    }
    window.addEventListener('scroll', onScroll);
    onScroll();

    // Smooth scrolling for internal links
    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener('click', function(e){
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if(!target) return;
        window.scrollTo({top: target.offsetTop - 20, behavior: 'smooth'});
        history.replaceState(null,'',this.getAttribute('href'));
      });
    });

    // GitHub Pages helper (downloads file)
    document.getElementById('githubPublish').addEventListener('click', ()=>{
      const blob = new Blob([document.documentElement.outerHTML], {type: 'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'index.html';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
